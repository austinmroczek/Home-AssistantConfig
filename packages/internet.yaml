# control the internet from Home Assistant

# adapted from https://medium.com/@arturlr/using-iot-button-to-control-my-kids-internet-usage-5bd825c1da76


##### setup the router #####
# # install mosquitto MQTT broker
# # help from https://www.onetransistor.eu/2019/05/mosquitto-mqtt-on-openwrt-router.html
# opkg install mosquitto mosquitto-client-nossl
# # edit /etc/mosquitto/mosquitto.conf as needed
# # generally follow directions of adapted from https://medium.com/@arturlr/using-iot-button-to-control-my-kids-internet-usage-5bd825c1da76
# # ...but instead of connecting to Amazon we're using the local server

##### setup the machine hosting home assistant (this one) #####

# # get the mosquitto clients
# apt install mosquitto-clients


##### set up switches #####
switch:
  - platform: mqtt
    unique_id: melanie_internet
    name: Melanie Internet
    state_topic: "ha/internet/kid_computer"
    command_topic: "ha/internet/kid_computer"
    retain: true
    availability:
      - topic: "ha/internet/kid_computer/available"

  - platform: mqtt
    unique_id: ipad_internet
    name: iPad Internet
    state_topic: "ha/internet/ipad"
    command_topic: "ha/internet/ipad"
    retain: true
    availability:
      - topic: "ha/internet/ipad/available"

  - platform: mqtt
    unique_id: guest_roku_internet
    name: Guest Roku Internet
    state_topic: "ha/internet/roku"
    command_topic: "ha/internet/roku"
    retain: true
    availability:
      - topic: "ha/internet/roku/available"

binary_sensor:
  - platform: mqtt
    name: YouTube
    state_topic: "ha/internet/youtube"
    device_class: connectivity
    availability:
      - topic: "ha/internet/youtube/available"

group:
  internet:
    name: Internet
    entities:
      - switch.melanie_internet
      - switch.ipad_internet
      - switch.guest_roku_internet
